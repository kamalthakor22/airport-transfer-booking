<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pearson Airport Drop Booking</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #ccc; /* grayish outside container */
  margin: 0;
  padding: 20px;
  display: flex;
  justify-content: center;
}
.container {
  display: flex;
  border: 2px solid #999;
  background: #fff; /* white inside container */
  max-width: 1200px;
  width: 100%;
  height: 90vh;
  overflow: hidden;/* keep this for rounded edges */
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
} 
.left, .right {
  height: 100%;
  overflow-y: auto;         /* each pane scrolls independently */
  box-sizing: border-box;   /* ensure padding doesn‚Äôt cut content */
  padding-bottom: 20px;     /* üëà add breathing room so last line is visible */
}
.left {
  flex: 0 0 400px;
  border-right: 1px solid #eee;
  position: sticky;
  top: 0;
}
.right {
  flex: 1;
  overflow-y: auto;
  background: #fff;
}
h1 { font-size: 1.8rem; margin-bottom: 10px; }
h2 { font-size: 1.2rem; color: #555; margin-bottom: 20px; }
.section { margin-bottom: 25px; }
.timeslot-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  gap: 10px;
  margin-top: 10px;
}
.timeslot {
  padding: 10px;
  text-align: center;
  border: 1px solid #ddd;
  border-radius: 8px;
  cursor: pointer;
  background: #fff;
  transition: all 0.2s;
}
.timeslot:hover { background: #eef5ff; border-color: #007bff; }
.timeslot.selected { background: #007bff; color: white; font-weight: bold; }
.timeslot.disabled { background: #f1f1f1; color: #aaa; border-color: #ccc; cursor: not-allowed; pointer-events: none; }
input, textarea { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; }
button {
  padding: 12px 20px;
  border: none;
  background: #007bff;
  color: white;
  border-radius: 8px;
  font-size: 1rem;
  cursor: pointer;
  transition: background 0.3s;
}
button:hover { background: #0056b3; }
.highlight { font-weight: bold; color: #007bff; }

/* Calendar styles */
.date-header { font-weight: bold; margin-bottom: 10px; }
#calendar-nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}
#calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 5px;
}
.calendar-day {
  padding: 10px;
  text-align: center;
  border: 1px solid #ddd;
  border-radius: 8px;
  cursor: pointer;
  position: relative;
  background: #fff;
  transition: background 0.2s;
}
.calendar-day:hover { background: #eef5ff; border-color: #007bff; }
.calendar-day.selected { background: #007bff; color: white; font-weight: bold; }
.calendar-day.disabled { background: #f1f1f1; color: #aaa; cursor: not-allowed; pointer-events: none; }
.calendar-day .dot {
  position: absolute;
  bottom: 5px;
  left: 50%;
  transform: translateX(-50%);
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: #007bff;
}
</style>
</head>
<body>
<div class="container">
  <!-- LEFT SIDE -->
  <div class="left">
    <p><strong>üìÜ Selected Date:</strong> <span id="chosenDate" class="highlight">Not selected</span></p>
    <p><strong>‚è∞ Selected Time:</strong> <span id="chosenTime" class="highlight">Not selected</span></p>
    <h1>Pearson Airport Drop Booking</h1>
    <p><strong>Total Time: 2 hr 30 min</strong></p>
    <p>Need a reliable and comfortable ride to Toronto Pearson Airport? I‚Äôve got you covered!</p>
    <p>‚úÖ Private 5-Seater SUV</p>
    <p>Fits 3 passengers comfortably with:</p>
    <ul>
      <li>3 large suitcases</li>
      <li>3 small carry-ons</li>
    </ul>
    <p>üí∞ Payment: Cash</p>
    <p>üí∞ Affordable Flat Rate: Based on the location (call +1 (289) 830-8942) and then book the date/time slot.</p>
    <p>üìç Pick-up Location: Ajax & surrounding areas</p>
    <p>üìç Drop-off: Toronto Pearson International Airport (YYZ)</p>
    <p>üìÜ Available 7 Days a Week ‚Äì Early Morning to Late Night</p>
    <p>üìù How to Book:</p>
    <ul>
      <li>üì± Call or Text: +1 (289) 830-8942</li>
      <li>üí¨ WhatsApp: +1 (289) 830-8942</li>
      <li>üåê Book using Booking Page: <a href="https://kamalthakor22.github.io/airport-transfer-booking" target="_blank">Airport Transfer Booking Page</a></li>
    </ul>
    <p>üöò Safe ‚Ä¢ Punctual ‚Ä¢ Friendly Service</p>
    <p>üßº Clean, smoke-free vehicle</p>
    <p>üéµ Music on request ‚Äì start your trip right!</p>
    <p>üëâ Book now and travel stress-free to the airport!</p>
  </div>

  <!-- RIGHT SIDE -->
  <div class="right">
    <div class="section">
      <div class="date-header">Select a Date & Time for your Booking</div>
      <div id="calendar-nav">
        <button id="prevMonth">&lt; Prev</button>
        <span id="monthYear"></span>
        <button id="nextMonth">Next &gt;</button>
      </div>
      <div id="calendar"></div>
    </div>

    <div class="section">
      <label>Select Time</label>
      <div class="timeslot-grid" id="timeslotGrid"></div>
    </div>

    <div class="section" id="details" style="display:none;">
      <label for="name">Full Name</label>
      <input type="text" id="name" required />
      <label for="phone">Phone Number</label>
      <input type="text" id="phone" required />
      <label for="email">Email</label>
      <input type="email" id="email" required />
      <label for="pickup">Pickup Location (Complete Address)</label>
      <textarea id="pickup" required></textarea>
      <label for="flight">Flight Name & Number</label>
      <input type="text" id="flight" required />
      <label for="passengers"># of Passengers</label>
      <input type="number" id="passengers" required />
      <label for="checkin"># of Check-In Baggage (Large)</label>
      <input type="number" id="checkin" required />
      <label for="carryon"># of Carry-On Baggage (Small)</label>
      <input type="number" id="carryon" required />
    </div>

    <button id="bookBtn" style="display:none;">Book</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBA4r1N4L_GwTrVrKku3lFYuj1gZIy-45w",
  authDomain: "ajaxairporttransfer.firebaseapp.com",
  projectId: "ajaxairporttransfer",
  storageBucket: "ajaxairporttransfer.firebasestorage.app",
  messagingSenderId: "664561343575",
  appId: "1:664561343575:web:3132b18dfa6ba41118d712"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const bookingsRef = collection(db, "bookings");

const timeslotGrid = document.getElementById("timeslotGrid");
const detailsForm = document.getElementById("details");
const bookBtn = document.getElementById("bookBtn");
const chosenDateEl = document.getElementById("chosenDate");
const chosenTimeEl = document.getElementById("chosenTime");

let selectedDate = null;
let selectedTime = null;
let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();
let bookedDates = [];

const monthYearEl = document.getElementById("monthYear");
const calendarEl = document.getElementById("calendar");
const prevBtn = document.getElementById("prevMonth");
const nextBtn = document.getElementById("nextMonth");

const fetchBookings = async () => {
  const snapshot = await getDocs(bookingsRef);
  const dateCount = {};
  snapshot.docs.forEach(doc => {
    const data = doc.data();
    dateCount[data.date] = dateCount[data.date] ? dateCount[data.date]+1 : 1;
  });
  bookedDates = [];
  Object.keys(dateCount).forEach(date => {
    if(dateCount[date]>=22) bookedDates.push(date);
  });
};

const generateCalendar = async () => {
  await fetchBookings();
  calendarEl.innerHTML = "";

  const firstDay = new Date(currentYear, currentMonth,1).getDay();
  const daysInMonth = new Date(currentYear, currentMonth+1,0).getDate();
  monthYearEl.innerText = new Date(currentYear, currentMonth).toLocaleString('default', { month:'long', year:'numeric' });

  for(let i=0;i<firstDay;i++){calendarEl.appendChild(document.createElement("div"));}
  for(let day=1; day<=daysInMonth; day++){
    const dayDiv = document.createElement("div");
    dayDiv.classList.add("calendar-day");
    const dateStr = `${currentYear}-${String(currentMonth+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
    dayDiv.innerText = day;
    if(bookedDates.includes(dateStr)){ dayDiv.classList.add("disabled"); }
    else{
      const dot = document.createElement("div");
      dot.classList.add("dot");
      dayDiv.appendChild(dot);
    }
    dayDiv.onclick = () => { if(!dayDiv.classList.contains("disabled")) selectCalendarDay(dayDiv, dateStr); };
    calendarEl.appendChild(dayDiv);
  }
};

const selectCalendarDay = (dayDiv, dateStr) => {
  document.querySelectorAll(".calendar-day").forEach(d=>d.classList.remove("selected"));
  dayDiv.classList.add("selected");
  selectedDate = dateStr;
  chosenDateEl.innerText = dateStr;
  generateSlots();
  disableBookedSlots(selectedDate);
  detailsForm.style.display="none";
  bookBtn.style.display="none";
  selectedTime=null;
  chosenTimeEl.innerText="Not selected";
};

prevBtn.onclick = () => { currentMonth--; if(currentMonth<0){currentMonth=11; currentYear--;} generateCalendar(); };
nextBtn.onclick = () => { currentMonth++; if(currentMonth>11){currentMonth=0; currentYear++;} generateCalendar(); };

const generateSlots = () => {
  timeslotGrid.innerHTML="";
  for(let h=0; h<=21; h++){
    let hour = h%12===0?12:h%12;
    let ampm = h<12?"AM":"PM";
    const slot = `${hour}:00 ${ampm}`;
    const div = document.createElement("div");
    div.classList.add("timeslot");
    div.innerText = slot;
    div.onclick = ()=>selectSlot(div, slot);
    timeslotGrid.appendChild(div);
  }
};

const selectSlot = (div, slot) => {
  document.querySelectorAll(".timeslot").forEach(t=>t.classList.remove("selected"));
  div.classList.add("selected");
  selectedTime = slot;
  detailsForm.style.display="block";
  bookBtn.style.display="block";
  chosenTimeEl.innerText=slot;
};

const disableBookedSlots = async (date)=>{
  const q = query(bookingsRef, where("date","==",date));
  const snapshot = await getDocs(q);
  const bookedTimes = snapshot.docs.map(doc=>doc.data().time);
  document.querySelectorAll(".timeslot").forEach(div=>{
    if(bookedTimes.includes(div.innerText)){
      div.classList.add("disabled");
      div.onclick = null;
    }
  });
};

bookBtn.addEventListener("click", async ()=>{
  if(!selectedDate || !selectedTime){alert("Please select a date and time slot"); return;}
  try{
    await addDoc(bookingsRef,{
      date:selectedDate,
      time:selectedTime,
      name:document.getElementById("name").value,
      phone:document.getElementById("phone").value,
      email:document.getElementById("email").value,
      pickup:document.getElementById("pickup").value,
      flight:document.getElementById("flight").value,
      passengers:document.getElementById("passengers").value,
      checkin:document.getElementById("checkin").value,
      carryon:document.getElementById("carryon").value,
      createdAt: new Date().toISOString()
    });
    alert("‚úÖ Booking confirmed!");
    location.reload();
  }catch(err){console.error(err); alert("‚ùå Failed to save booking.");}
});

generateCalendar();
</script>
</body>
</html>







