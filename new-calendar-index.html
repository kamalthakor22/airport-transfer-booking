<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pearson Airport Drop Booking</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f5f5f5;
    overflow: hidden;
  }
  .container {
    display: flex;
    height: 100vh;
    overflow: hidden;
  }
  .left, .right {
    flex: 1;
    padding: 30px;
    overflow-y: auto;
    box-sizing: border-box;
  }
  .left { background: white; }
  .right { background: #fafafa; }
  h1 { margin-top: 0; }
  ul { padding-left: 20px; }
  .highlight { color: #0077cc; font-weight: bold; }

  /* Calendar styling */
  .calendar {
    max-width: 400px;
    margin: 0 auto 20px auto;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    overflow: hidden;
  }
  .calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #0077cc;
    color: white;
    padding: 15px;
    font-size: 18px;
  }
  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
    padding: 10px;
  }
  .day {
    text-align: center;
    padding: 10px;
    border-radius: 8px;
    cursor: pointer;
    position: relative;
  }
  .day.disabled { color: #ccc; cursor: not-allowed; }
  .day:hover:not(.disabled) { background: #e6f2ff; }
  .day.selected { background: #0077cc; color: white; }
  .dot {
    width: 6px;
    height: 6px;
    background: #0077cc;
    border-radius: 50%;
    position: absolute;
    bottom: 5px;
    left: 50%;
    transform: translateX(-50%);
  }
  .time-slots {
    margin-top: 20px;
    text-align: center;
  }
  .time-slot {
    display: inline-block;
    margin: 5px;
    padding: 8px 15px;
    background: #e6f2ff;
    border-radius: 8px;
    cursor: pointer;
  }
  .time-slot.disabled { background: #ccc; cursor: not-allowed; }
  .time-slot.selected { background: #0077cc; color: white; }

  /* Floating booking summary card (starts hidden off-left) */
  .popup {
    position: fixed;
    top: 20px;
    left: -360px;              /* off-screen start */
    width: 280px;
    background: rgba(0, 119, 204, 0.95);
    color: white;
    padding: 15px 20px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    z-index: 999;
    transition: left 0.45s cubic-bezier(.2,.9,.2,1), opacity 0.3s ease;
    opacity: 0;
  }
  .popup.show {
    left: 20px;                /* visible position */
    opacity: 1;
  }
  .popup h4 { margin: 0 0 10px 0; font-size: 16px; }
  .popup p { margin: 6px 0; font-size: 14px; }

  /* small close button */
  .popup .close {
    position: absolute;
    top: 8px;
    right: 10px;
    cursor: pointer;
    font-weight: bold;
    font-size: 16px;
    opacity: 0.85;
  }

  /* Mobile */
  @media (max-width: 768px) {
    .container { flex-direction: column; }
    .left { flex: none; height: 45vh; }
    .right { flex: 1; height: 55vh; }
    .popup { width: 260px; left: -320px; }
    .popup.show { left: 10px; }
  }
</style>
</head>
<body>

<div class="popup" id="popup" aria-hidden="true">
  <span class="close" id="popupClose" title="Close">&times;</span>
  <h4>Booking Summary</h4>
  <p>Date: <span id="popupDate">Not selected</span></p>
  <p>Time: <span id="popupTime">Not selected</span></p>
  <p>Passengers: <span id="popupPassengers">3</span></p>
  <p>Pickup: <span id="popupPickup">Ajax & surrounding areas</span></p>
</div>

<div class="container">
  <div class="left">
    <h1>Pearson Airport Drop Booking</h1>
    <p><strong>Total Time: 2 hr 30 min</strong></p>
    <p>Need a reliable and comfortable ride to Toronto Pearson Airport? I‚Äôve got you covered!</p>
    <p>‚úÖ Private 5-Seater SUV</p>
    <p>Fits 3 passengers comfortably with:</p>
    <ul>
      <li>3 large suitcases</li>
      <li>3 small carry-ons</li>
    </ul>
    <p>üí∞ Payment: Cash</p>
    <p>üí∞ Affordable Flat Rate: Based on the location (call +1 (289) 830-8942) and then book the date/time slot.</p>
    <p>üìç Pick-up Location: Ajax & surrounding areas</p>
    <p>üìç Drop-off: Toronto Pearson International Airport (YYZ)</p>
    <p>üìÜ Available 7 Days a Week ‚Äì Early Morning to Late Night</p>
    <p>üìù How to Book:</p>
    <ul>
      <li>üì± Call or Text: +1 (289) 830-8942</li>
      <li>üí¨ WhatsApp: +1 (289) 830-8942</li>
      <li>üåê Book using Booking Page: <a href="https://kamalthakor22.github.io/airport-transfer-booking" target="_blank">Airport Transfer Booking Page</a></li>
    </ul>
    <p>üöò Safe ‚Ä¢ Punctual ‚Ä¢ Friendly Service ‚Ä¢ Trustworthy</p>
    <p>üßº Clean, smoke-free vehicle ‚Ä¢ In-Car Charging ports ‚Ä¢ Climate Temperate Control</p>
    <p>üéµ Music on request ‚Äì start your trip right!</p>
    <p>üëâ Book now and travel stress-free to the airport!</p>
    <p><strong>Urgent Booking?!? Within 30 minutes?</strong> Please Call ‚Ä¢ Additional 25% surcharge</p>
  </div>

  <div class="right">
    <div class="calendar">
      <div class="calendar-header">
        <button id="prevMonth">&lt;</button>
        <div id="monthYear"></div>
        <button id="nextMonth">&gt;</button>
      </div>
      <div class="calendar-grid" id="calendarGrid"></div>
    </div>
    <div class="time-slots" id="timeSlots"></div>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyBA4r1N4L_GwTrVrKku3lFYuj1gZIy-45w",
  authDomain: "ajaxairporttransfer.firebaseapp.com",
  projectId: "ajaxairporttransfer",
  storageBucket: "ajaxairporttransfer.firebasestorage.app",
  messagingSenderId: "664561343575",
  appId: "1:664561343575:web:3132b18dfa6ba41118d712"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
</script>

<script>
const calendarGrid = document.getElementById("calendarGrid");
const monthYear = document.getElementById("monthYear");
const prevMonthBtn = document.getElementById("prevMonth");
const nextMonthBtn = document.getElementById("nextMonth");

const popupDate = document.getElementById("popupDate");
const popupTime = document.getElementById("popupTime");

let currentDate = new Date();
let selectedDate = null;
let selectedTime = null;
let visibleMonth = currentDate.getMonth();
let visibleYear = currentDate.getFullYear();

const timeSlots = [];
for (let h = 0; h < 24; h++) {
  const hour = h % 12 === 0 ? 12 : h % 12;
  const ampm = h < 12 ? "AM" : "PM";
  timeSlots.push(`${hour}:00 ${ampm}`);
}

function renderCalendar() {
  calendarGrid.innerHTML = "";
  const firstDay = new Date(visibleYear, visibleMonth, 1);
  const lastDay = new Date(visibleYear, visibleMonth + 1, 0);
  const startDay = firstDay.getDay();
  const totalDays = lastDay.getDate();

  monthYear.textContent = firstDay.toLocaleString("default", { month: "long", year: "numeric" });
  prevMonthBtn.disabled = visibleMonth === currentDate.getMonth() && visibleYear === currentDate.getFullYear();

  for (let i = 0; i < startDay; i++) calendarGrid.appendChild(document.createElement("div"));

  for (let day = 1; day <= totalDays; day++) {
    const dayEl = document.createElement("div");
    dayEl.className = "day";
    dayEl.textContent = day;

    const dateObj = new Date(visibleYear, visibleMonth, day);
    dateObj.setHours(0,0,0,0);
    const now = new Date();
    now.setHours(0,0,0,0);

    if (dateObj < now) dayEl.classList.add("disabled");
    else dayEl.innerHTML += '<div class="dot"></div>';

    dayEl.addEventListener("click", () => {
      if (!dayEl.classList.contains("disabled")) {
        document.querySelectorAll(".day").forEach(d => d.classList.remove("selected"));
        dayEl.classList.add("selected");
        selectedDate = new Date(visibleYear, visibleMonth, day);
        popupDate.textContent = selectedDate.toDateString();
        renderTimeSlots();
      }
    });

    calendarGrid.appendChild(dayEl);
  }
}

function renderTimeSlots() {
  const timeSlotsEl = document.getElementById("timeSlots");
  timeSlotsEl.innerHTML = "";
  const now = new Date();

  timeSlots.forEach(slot => {
    const [time, ampm] = slot.split(" ");
    const [hour, minute] = time.split(":").map(Number);
    let slotDate = new Date(selectedDate);
    let adjustedHour = ampm === "PM" && hour !== 12 ? hour + 12 : hour;
    if (ampm === "AM" && hour === 12) adjustedHour = 0;
    slotDate.setHours(adjustedHour, minute);

    const slotEl = document.createElement("div");
    slotEl.className = "time-slot";
    slotEl.textContent = slot;

    if (selectedDate.toDateString() === now.toDateString() && slotDate < new Date(now.getTime() + 60*60*1000)) {
      slotEl.classList.add("disabled");
    }

    slotEl.addEventListener("click", () => {
      if (!slotEl.classList.contains("disabled")) {
        document.querySelectorAll(".time-slot").forEach(s => s.classList.remove("selected"));
        slotEl.classList.add("selected");
        selectedTime = slot;
        popupTime.textContent = selectedTime;
        showBookingForm(slotEl);
      }
    });

    timeSlotsEl.appendChild(slotEl);
  });
}

function showBookingForm(slotEl) {
  // Remove any existing form
  const existingForm = document.querySelector(".booking-form");
  if (existingForm) existingForm.remove();

  const form = document.createElement("form");
  form.className = "booking-form";
  form.innerHTML = `
    <h4>Enter Booking Details</h4>
    <label>Full Name</label>
    <input type="text" id="fullName" required />
    <label>Mobile Number</label>
    <input type="tel" id="mobileNumber" required />
    <label>Email Address</label>
    <input type="email" id="emailAddress" required />
    <label>Pickup Location</label>
    <input type="text" id="pickupLocation" placeholder="e.g. 55 Kingston Rd, Ajax" required />
    <div>
      <label>Terminal:</label><br/>
      <label><input type="radio" name="terminal" value="1" required /> T1</label>
      <label><input type="radio" name="terminal" value="3" /> T3</label>
    </div>
    <label># of Passengers</label>
    <input type="number" id="numPassengers" min="1" max="3" value="3" />
    <label># of Large Bags</label>
    <input type="number" id="numLargeBags" min="0" />
    <label># of Small Bags</label>
    <input type="number" id="numSmallBags" min="0" />
    <button type="submit">Book Now</button>
  `;

  // Style the form (light, clean look)
  form.style.background = "#fff";
  form.style.marginTop = "15px";
  form.style.padding = "15px";
  form.style.border = "1px solid #ddd";
  form.style.borderRadius = "8px";
  form.style.boxShadow = "0 2px 6px rgba(0,0,0,0.1)";
  form.style.textAlign = "left";

  form.querySelectorAll("input").forEach(inp => {
    inp.style.display = "block";
    inp.style.width = "100%";
    inp.style.marginBottom = "10px";
    inp.style.padding = "8px";
    inp.style.borderRadius = "6px";
    inp.style.border = "1px solid #ccc";
  });

  form.querySelector("button").style.background = "#0077cc";
  form.querySelector("button").style.color = "#fff";
  form.querySelector("button").style.border = "none";
  form.querySelector("button").style.padding = "10px 15px";
  form.querySelector("button").style.borderRadius = "6px";
  form.querySelector("button").style.cursor = "pointer";
  form.querySelector("button").style.fontWeight = "bold";

  slotEl.insertAdjacentElement("afterend", form);
  form.scrollIntoView({ behavior: "smooth", block: "center" });
  document.getElementById("fullName").focus();

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    saveBooking(form);
  });
}

function saveBooking(form) {
  const data = {
    date: selectedDate.toDateString(),
    time: selectedTime,
    fullName: form.fullName?.value || document.getElementById("fullName").value,
    mobile: form.mobileNumber?.value || document.getElementById("mobileNumber").value,
    email: form.emailAddress?.value || document.getElementById("emailAddress").value,
    pickup: form.pickupLocation?.value || document.getElementById("pickupLocation").value,
    terminal: form.querySelector('input[name="terminal"]:checked')?.value || "",
    passengers: form.numPassengers?.value || document.getElementById("numPassengers").value,
    largeBags: form.numLargeBags?.value || document.getElementById("numLargeBags").value,
    smallBags: form.numSmallBags?.value || document.getElementById("numSmallBags").value,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  };

  db.collection("bookings").add(data)
    .then(() => {
      alert("‚úÖ Booking successfully submitted!");
      form.reset();
    })
    .catch(err => {
      console.error("Error saving booking:", err);
      alert("‚ùå Failed to save booking.");
    });
}

prevMonthBtn.addEventListener("click", () => {
  if (!(visibleMonth === currentDate.getMonth() && visibleYear === currentDate.getFullYear())) {
    visibleMonth--;
    if (visibleMonth < 0) { visibleMonth = 11; visibleYear--; }
    renderCalendar();
  }
});

nextMonthBtn.addEventListener("click", () => {
  visibleMonth++;
  if (visibleMonth > 11) { visibleMonth = 0; visibleYear++; }
  renderCalendar();
});

renderCalendar();
</script>

</body>
</html>
