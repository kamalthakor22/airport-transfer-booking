<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Pearson Airport Drop Booking</title>
<style>
body {
Â  font-family: Arial, sans-serif;
Â  background: #ccc; /* grayish outside container */
Â  margin: 0;
Â  padding: 20px;
Â  display: flex;
Â  justify-content: center;
Â  position: relative; /* ADDED for popup positioning */
}
.container {
Â  display: flex;
Â  flex-direction: row; /* default side by side */
Â  border: 2px solid #999;
Â  background: #fff; /* white inside container */
Â  max-width: 1200px;
Â  width: 100%;
Â  height: 90vh;
Â  overflow: hidden; /* keep rounded corners clean */
Â  border-radius: 10px;
Â  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}
.left, .right {
Â  padding: 30px;
Â  height: 100%;
Â  overflow-y: auto;
Â  box-sizing: border-box;
Â  padding-bottom: 20px; /* so last line is visible */
}
.left {
Â  flex: 0 0 400px;
Â  border-right: 1px solid #eee;
}
.right {
Â  flex: 1;
Â  background: #fff;
}

/* Responsive Mobile Portrait */
@media (max-width: 768px) {
Â  .container {
Â  Â  flex-direction: column;
Â  Â  height: auto; /* allow natural height */ /* let height grow naturally */
Â  }
Â  .left, .right {
Â  Â  flex: none;
Â  Â  height: auto;
Â  Â  max-height: none;
Â  }
Â  .left {
Â  Â  border-right: none;
Â  Â  border-bottom: 1px solid #eee;
Â  Â  max-height: 40vh;Â  Â  Â  Â /* ğŸ‘ˆ shrink left pane */
Â  Â  overflow-y: auto;Â  Â  Â  Â /* still scrollable if content is long */
Â  }
}

h1 { font-size: 1.8rem; margin-bottom: 10px; }
h2 { font-size: 1.2rem; color: #555; margin-bottom: 20px; }
.section { margin-bottom: 25px; }
.timeslot-grid {
Â  display: grid;
Â  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
Â  gap: 10px;
Â  margin-top: 10px;
}
.timeslot {
Â  padding: 10px;
Â  text-align: center;
Â  border: 1px solid #ddd;
Â  border-radius: 8px;
Â  cursor: pointer;
Â  background: #fff;
Â  transition: all 0.2s;
}
.timeslot:hover { background: #eef5ff; border-color: #007bff; }
.timeslot.selected { background: #007bff; color: white; font-weight: bold; }
.timeslot.disabled { background: #f1f1f1; color: #aaa; border-color: #ccc; cursor: not-allowed; pointer-events: none; }
input, textarea { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; }
button {
Â  padding: 12px 20px;
Â  border: none;
Â  background: #007bff;
Â  color: white;
Â  border-radius: 8px;
Â  font-size: 1rem;
Â  cursor: pointer;
Â  transition: background 0.3s;
}
button:hover { background: #0056b3; }
.highlight { font-weight: bold; color: #007bff; }

/* Calendar styles */
.date-header { font-weight: bold; margin-bottom: 10px; }
#calendar-nav {
Â  display: flex;
Â  justify-content: space-between;
Â  align-items: center;
Â  margin-bottom: 10px;
}
#calendar {
Â  display: grid;
Â  grid-template-columns: repeat(7, 1fr);
Â  gap: 5px;
}
/* ADDED: Day name styles */
.day-name {
Â  text-align: center;
Â  font-weight: bold;
Â  color: #555;
Â  padding: 5px 0;
}
/* END ADDED */
.calendar-day {
Â  padding: 10px;
Â  text-align: center;
Â  border: 1px solid #ddd;
Â  border-radius: 8px;
Â  cursor: pointer;
Â  position: relative;
Â  background: #fff;
Â  transition: background 0.2s;
}
.calendar-day:hover { background: #eef5ff; border-color: #007bff; }
.calendar-day.selected { background: #007bff; color: white; font-weight: bold; }
.calendar-day.disabled { background: #f1f1f1; color: #aaa; cursor: not-allowed; pointer-events: none; }
.calendar-day .dot {
Â  position: absolute;
Â  bottom: 5px;
Â  left: 50%;
Â  transform: translateX(-50%);
Â  width: 6px;
Â  height: 6px;
Â  border-radius: 50%;
Â  background: #007bff;
}

/* ADDED: Popup styles */
#selectionPopup {
Â  position: fixed;
Â  top: 20px; /* Adjust based on your margin/padding */
Â  right: 20px; /* Top right */
Â  background: #007bff;
Â  color: white;
Â  padding: 15px;
Â  border-radius: 8px;
Â  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
Â  z-index: 1000;
Â  display: none; /* Hidden by default */
Â  min-width: 250px;
Â  animation: fadeIn 0.3s ease-out;
}
@keyframes fadeIn {
Â  from { opacity: 0; transform: translateY(-10px); }
Â  to { opacity: 1; transform: translateY(0); }
}
#popupDate, #popupTime { font-weight: bold; display: block; margin-top: 5px; }
/* END ADDED: Popup styles */
</style>
</head>
<body>
<div id="selectionPopup">
Â  <strong>Your Selected Booking Time:</strong>
Â  <span id="popupDate"></span>
Â  <span id="popupTime"></span>
</div>
<div class="container">
Â  Â  <div class="left">
Â  Â  <p><strong>ğŸ“† Selected Date:</strong> <span id="chosenDate" class="highlight">Not selected</span></p>
Â  Â  <p><strong>â° Selected Time:</strong> <span id="chosenTime" class="highlight">Not selected</span></p>
Â  Â  <h1>Pearson Airport Drop Booking</h1>
Â  Â  <p><strong>Total Time: 2 hr 30 min</strong></p>
Â  Â  <p>Need a reliable and comfortable ride to Toronto Pearson Airport? Iâ€™ve got you covered!</p>
Â  Â  <p>âœ… Private 5-Seater SUV</p>
Â  Â  <p>Fits 3 passengers comfortably with:</p>
Â  Â  <ul>
Â  Â  Â  <li>3 large suitcases</li>
Â  Â  Â  <li>3 small carry-ons</li>
Â  Â  </ul>
Â  Â  <p>ğŸ’° Payment: Cash</p>
Â  Â  <p>ğŸ’° Affordable Flat Rate: Based on the location (call +1 (289) 830-8942) and then book the date/time slot.</p>
Â  Â  <p>ğŸ“ Pick-up Location: Ajax & surrounding areas</p>
Â  Â  <p>ğŸ“ Drop-off: Toronto Pearson International Airport (YYZ)</p>
Â  Â  <p>ğŸ“† Available 7 Days a Week â€“ Early Morning to Late Night</p>
Â  Â  <p>ğŸ“ How to Book:</p>
Â  Â  <ul>
Â  Â  Â  <li>ğŸ“± Call or Text: +1 (289) 830-8942</li>
Â  Â  Â  <li>ğŸ’¬ WhatsApp: +1 (289) 830-8942</li>
Â  Â  Â  <li>ğŸŒ Book using Booking Page: <a href="https://kamalthakor22.github.io/airport-transfer-booking" target="_blank">Airport Transfer Booking Page</a></li>
Â  Â  </ul>
Â  Â  <p>ğŸš˜ Safe â€¢ Punctual â€¢ Friendly Service â€¢ Trustworthy</p>
Â  Â  <p>ğŸ§¼ Clean, smoke-free vehicle â€¢ In-Car Charging ports â€¢ Climate Temperate Control</p>
Â  Â  <p>ğŸµ Music on request â€“ start your trip right!</p>
Â  Â  <p>ğŸ‘‰ Book now and travel stress-free to the airport!</p>
Â  Â  <p> <strong>Urgent Booking?!? Within 30 minutes?</strong> Please Call â€¢ Additional 25% surcharge</p>
Â  </div>

Â  Â  <div class="right">
Â  Â  <div class="section">
Â  Â  Â  <div class="date-header">Select a Date & Time for your Booking</div>
Â  Â  Â  <div id="calendar-nav">
Â  Â  Â  Â  <button id="prevMonth">&lt; Prev</button>
Â  Â  Â  Â  <span id="monthYear"></span>
Â  Â  Â  Â  <button id="nextMonth">Next &gt;</button>
Â  Â  Â  </div>
Â  Â  Â  <div id="calendar"></div>
Â  Â  </div>

Â  Â  <div class="section">
Â  Â  Â  <label>Select Time</label>
Â  Â  Â  <div class="timeslot-grid" id="timeslotGrid"></div>
Â  Â  </div>

Â  Â  <div class="section" id="details" style="display:none;">
Â  Â  Â  <label for="name">Full Name</label>
Â  Â  Â  <input type="text" id="name" required />
Â  Â  Â  <label for="phone">Phone Number</label>
Â  Â  Â  <input type="text" id="phone" required />
Â  Â  Â  <label for="email">Email</label>
Â  Â  Â  <input type="email" id="email" required />
Â  Â  Â  <label for="pickup">Pickup Location (Complete Address)</label>
Â  Â  Â  <textarea id="pickup" required></textarea>
Â  Â  Â  <label for="flight">Flight Name & Number</label>
Â  Â  Â  <input type="text" id="flight" required />
Â  Â  Â  <label for="passengers"># of Passengers</label>
Â  Â  Â  <input type="number" id="passengers" required />
Â  Â  Â  <label for="checkin"># of Check-In Baggage (Large)</label>
Â  Â  Â  <input type="number" id="checkin" required />
Â  Â  Â  <label for="carryon"># of Carry-On Baggage (Small)</label>
Â  Â  Â  <input type="number" id="carryon" required />
Â  Â  </div>

Â  Â  <button id="bookBtn" style="display:none;">Book</button>
Â  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

const firebaseConfig = {
Â  apiKey: "AIzaSyBA4r1N4L_GwTrVrKku3lFYuj1gZIy-45w",
Â  authDomain: "ajaxairporttransfer.firebaseapp.com",
Â  projectId: "ajaxairporttransfer",
Â  storageBucket: "ajaxairporttransfer.firebasestorage.app",
Â  messagingSenderId: "664561343575",
Â  appId: "1:664561343575:web:3132b18dfa6ba41118d712"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const bookingsRef = collection(db, "bookings");

const timeslotGrid = document.getElementById("timeslotGrid");
const detailsForm = document.getElementById("details");
const bookBtn = document.getElementById("bookBtn");
const chosenDateEl = document.getElementById("chosenDate");
const chosenTimeEl = document.getElementById("chosenTime");

// ADDED: Popup elements
const selectionPopup = document.getElementById("selectionPopup");
const popupDateEl = document.getElementById("popupDate");
const popupTimeEl = document.getElementById("popupTime");
// END ADDED

let selectedDate = null;
let selectedTime = null;
let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();
let bookedDates = [];

// MODIFIED: Reference for "Now" to disable past dates/times
const NOW = new Date();
const TODAY_YEAR = NOW.getFullYear();
const TODAY_MONTH = NOW.getMonth();
const TODAY_DATE = NOW.getDate();
const CURRENT_HOUR_24HR = NOW.getHours(); // Use 24-hr format for easy comparison
// END MODIFIED

const monthYearEl = document.getElementById("monthYear");
const calendarEl = document.getElementById("calendar");
const prevBtn = document.getElementById("prevMonth");
const nextBtn = document.getElementById("nextMonth");

const fetchBookings = async () => {
Â  const snapshot = await getDocs(bookingsRef);
Â  const dateCount = {};
Â  snapshot.docs.forEach(doc => {
Â  Â  const data = doc.data();
Â  Â  dateCount[data.date] = dateCount[data.date] ? dateCount[data.date]+1 : 1;
Â  });
Â  bookedDates = [];
Â  Object.keys(dateCount).forEach(date => {
Â  Â  if(dateCount[date]>=20) bookedDates.push(date); 
Â  });
};

const generateCalendar = async () => {
Â  await fetchBookings();
Â  calendarEl.innerHTML = "";

Â  // ADDED: Day names for usability and layout fix
Â  const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
Â  dayNames.forEach(name => {
Â  Â  const header = document.createElement("div");
Â  Â  header.innerText = name;
Â  Â  header.classList.add("day-name"); // Use new class for styling
Â  Â  calendarEl.appendChild(header);
Â  });
Â  // END ADDED

Â  const firstDay = new Date(currentYear, currentMonth,1).getDay();
Â  const daysInMonth = new Date(currentYear, currentMonth+1,0).getDate();
Â  monthYearEl.innerText = new Date(currentYear, currentMonth).toLocaleString('default', { month:'long', year:'numeric' });

Â  // Skip the first few cells based on the day of the week
Â  for(let i=0;i<firstDay;i++){calendarEl.appendChild(document.createElement("div"));}
Â  
Â  for(let day=1; day<=daysInMonth; day++){
Â  Â  const dayDiv = document.createElement("div");
Â  Â  dayDiv.classList.add("calendar-day");
Â  Â  const dateStr = `${currentYear}-${String(currentMonth+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
Â  Â  dayDiv.innerText = day;
Â  Â  
Â  Â  // START MODIFIED/ADDED: Date disabling logic
Â  Â  // This logic ensures the current day is selectable, but past days are not.
Â  Â  const dateIsPast = (currentYear < TODAY_YEAR) || 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â (currentYear === TODAY_YEAR && currentMonth < TODAY_MONTH) ||
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â (currentYear === TODAY_YEAR && currentMonth === TODAY_MONTH && day < TODAY_DATE);

Â  Â  if(bookedDates.includes(dateStr) || dateIsPast){ 
Â  Â  Â  dayDiv.classList.add("disabled"); 
Â  Â  }
Â  Â  else{
Â  Â  Â  const dot = document.createElement("div");
Â  Â  Â  dot.classList.add("dot");
Â  Â  Â  dayDiv.appendChild(dot);
Â  Â  }
Â  Â  
Â  Â  dayDiv.onclick = () => { if(!dayDiv.classList.contains("disabled")) selectCalendarDay(dayDiv, dateStr); };
Â  Â  calendarEl.appendChild(dayDiv);
Â  Â  // END MODIFIED/ADDED
Â  }
};

const selectCalendarDay = (dayDiv, dateStr) => {
Â  document.querySelectorAll(".calendar-day").forEach(d=>d.classList.remove("selected"));
Â  dayDiv.classList.add("selected");
Â  selectedDate = dateStr;
Â  chosenDateEl.innerText = dateStr;
Â  generateSlots();
Â  disableBookedSlots(selectedDate);
Â  detailsForm.style.display="none";
Â  bookBtn.style.display="none";
Â  selectedTime=null;
Â  chosenTimeEl.innerText="Not selected";
Â  
Â  // ADDED: Update popup date
Â  popupDateEl.innerText = `Date: ${formatDate(dateStr)}`;
Â  popupTimeEl.innerText = "Time: Not selected";
Â  selectionPopup.style.display = 'block';
Â  // END ADDED
};

// ADDED: Function to format date for better popup readability
const formatDate = (dateStr) => {
Â  const date = new Date(dateStr + 'T00:00:00'); // Use T00:00:00 to prevent timezone issues
Â  return date.toLocaleDateString('en-US', { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' });
};

// MODIFIED: Handle navigation and button check
prevBtn.onclick = () => { 
Â  currentMonth--; 
Â  if(currentMonth<0){currentMonth=11; currentYear--;} 
Â  generateCalendar(); 
Â  checkNavButtons();
};
nextBtn.onclick = () => { 
Â  currentMonth++; 
Â  if(currentMonth>11){currentMonth=0; currentYear++;} 
Â  generateCalendar(); 
Â  checkNavButtons();
};

// MODIFIED: Check navigation buttons
const checkNavButtons = () => {
Â  // Disable prev if the current view is the current month and year
Â  const isCurrentMonth = (currentYear === TODAY_YEAR && currentMonth === TODAY_MONTH);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  prevBtn.disabled = isCurrentMonth;
Â  prevBtn.style.opacity = isCurrentMonth ? '0.5' : '1';
Â  prevBtn.style.cursor = isCurrentMonth ? 'not-allowed' : 'pointer';
};

const generateSlots = () => {
Â  timeslotGrid.innerHTML="";
Â  
Â  // ADDED: Check if the selected date is today
Â  const selectedDateObj = new Date(selectedDate);
Â  const isToday = selectedDateObj.getFullYear() === TODAY_YEAR && 
Â  Â  Â  Â  Â  Â  Â  Â  Â  selectedDateObj.getMonth() === TODAY_MONTH && 
Â  Â  Â  Â  Â  Â  Â  Â  Â  selectedDateObj.getDate() === TODAY_DATE;

Â  for(let h=0; h<=21; h++){
Â  Â  let hour = h%12===0?12:h%12;
Â  Â  let ampm = h<12?"AM":"PM";
Â  Â  const slot = `${hour}:00 ${ampm}`;
Â  Â  const div = document.createElement("div");
Â  Â  div.classList.add("timeslot");
Â  Â  div.innerText = slot;
Â  Â  
Â  Â  // START MODIFIED/ADDED: Time disabling logic
Â  Â  let isDisabled = false;
Â  Â  if (isToday) {
Â  Â  Â  // Use a 1-hour lead time for regular bookings (60 minutes)
Â  Â  Â  const leadTimeMinutes = 60; 
Â  Â  Â  
Â  Â  Â  // Calculate the minute threshold for the current hour 'h'
Â  Â  Â  // Example: If h=12 (12:00 PM slot), it should be available until 11:00 AM (12:00 PM minus 60 min lead time).
Â  Â  Â  // Since slots are only on the hour (X:00), we just compare the hours.
Â  Â  Â  
Â  Â  Â  // Determine the current time in minutes since midnight
Â  Â  Â  const currentTimeInMinutes = CURRENT_HOUR_24HR * 60 + NOW.getMinutes();
Â  Â  Â  
Â  Â  Â  // Determine the slot time in minutes since midnight, minus the required lead time
Â  Â  Â  const slotTimeMinusLead = (h * 60) - leadTimeMinutes;
Â  Â  Â  
Â  Â  Â  if (currentTimeInMinutes > slotTimeMinusLead) {
Â  Â  Â  Â  isDisabled = true;
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  // If you want the 'Urgent Booking' surcharge (within 30 mins) to still be possible
Â  Â  Â  // you can adjust the leadTimeMinutes here, but for disabling the slot, 
Â  Â  Â  // using a buffer like 60 minutes is standard for pre-booked transport.
Â  Â  }

Â  Â  if (isDisabled) {
Â  Â  Â  div.classList.add("disabled");
Â  Â  Â  div.onclick = null;
Â  Â  } else {
Â  Â  Â  div.onclick = ()=>selectSlot(div, slot);
Â  Â  }
Â  Â  // END MODIFIED/ADDED

Â  Â  timeslotGrid.appendChild(div);
Â  }
};

const selectSlot = (div, slot) => {
Â  document.querySelectorAll(".timeslot").forEach(t=>t.classList.remove("selected"));
Â  div.classList.add("selected");
Â  selectedTime = slot;
Â  detailsForm.style.display="block";
Â  bookBtn.style.display="block";
Â  chosenTimeEl.innerText=slot;
Â  
Â  // ADDED: Update and show the popup
Â  popupTimeEl.innerText = `Time: ${slot}`;
Â  selectionPopup.style.display = 'block';
Â  // END ADDED
};

const disableBookedSlots = async (date)=>{
Â  const q = query(bookingsRef, where("date","==",date));
Â  const snapshot = await getDocs(q);
Â  const bookedTimes = snapshot.docs.map(doc=>doc.data().time);
Â  document.querySelectorAll(".timeslot").forEach(div=>{
Â  Â  if(bookedTimes.includes(div.innerText)){
Â  Â  Â  // Check if it's already disabled by the time logic, if not, disable for booking
Â  Â  Â  if (!div.classList.contains("disabled")) {
Â  Â  Â  Â  div.classList.add("disabled");
Â  Â  Â  Â  div.onclick = null;
Â  Â  Â  }
Â  Â  }
Â  });
};

bookBtn.addEventListener("click", async ()=>{
Â  if(!selectedDate || !selectedTime){alert("Please select a date and time slot"); return;}
Â  try{
Â  Â  await addDoc(bookingsRef,{
Â  Â  Â  date:selectedDate,
Â  Â  Â  time:selectedTime,
Â  Â  Â  name:document.getElementById("name").value,
Â  Â  Â  phone:document.getElementById("phone").value,
Â  Â  Â  email:document.getElementById("email").value,
Â  Â  Â  pickup:document.getElementById("pickup").value,
Â  Â  Â  flight:document.getElementById("flight").value,
Â  Â  Â  passengers:document.getElementById("passengers").value,
Â  Â  Â  checkin:document.getElementById("checkin").value,
Â  Â  Â  carryon:document.getElementById("carryon").value,
Â  Â  Â  createdAt: new Date().toISOString()
Â  Â  });
Â  Â  alert("âœ… Booking confirmed!");
Â  Â  // ADDED: Hide popup on successful booking
Â  Â  selectionPopup.style.display = 'none'; 
Â  Â  location.reload();
Â  }catch(err){console.error(err); alert("âŒ Failed to save booking.");}
});

// MODIFIED: Run checkNavButtons on initial load
generateCalendar().then(() => {
Â  checkNavButtons();
});
</script>
</body>
</html>
